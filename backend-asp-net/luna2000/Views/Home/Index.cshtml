@using System.Globalization
@model luna2000.Dto.MainViewDto

<!-- Кнопки для навигации -->
@*<div class="nav-buttons">
    <a href="driver" class="nav-button">Водители</a>
    <a href="/car" class="nav-button">Машины</a>
    <a href="download.html" class="nav-button">Скачать</a>
</div>*@

<!-- Таблица для отображения данных -->
<h2>Таблица данных</h2>
<table id="mainTable">
    <thead>
        <tr>
            <th>Водитель</th>
            <th>Авто</th>
            <th>Баланс</th>
            <th>Аренда</th>
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
        <!-- Данные будут вставлены с помощью JavaScript -->
        @foreach (var rental in Model.Rentals)
        {
            @if (rental.Driver == null || rental.Car == null)
            {
                <tr>
                    <div>
                        Bad Data
                    </div>
                </tr>

                continue;
            }

            <tr>
                <td>
                    @rental.Driver.Fio
                </td>
                <td>
                    @rental.Car.BrandModel (@rental.Car.PlateNumber)
                </td>
                <td>
                    <input type="number" class="balance"
                       value="@rental.Driver.Balance.ToString(CultureInfo.InvariantCulture).Replace(',', '.')"
                       readonly="">
                </td>
                <td>

                    <input type="number" step=".01" class="rent"
                       value="@rental.Rent.ToString(CultureInfo.InvariantCulture).Replace(',', '.')"
                       readonly="">
                </td>
                <td>
                    <button class="add-balance-button"
                        onclick="location.replace('/driver/addbalance?driverId=@rental.DriverId')">
                        Внести депозит
                    </button>
                    <button class="edit-button"
                        data-driver="@rental.DriverId"
                        data-car="@rental.CarId"
                        data-rent="@rental.Rent.ToString(CultureInfo.InvariantCulture).Replace(',', '.')"
                        data-id="@rental.Id">
                        Редактировать
                    </button>
                    <button class="delete-button" data-id="@rental.Id">Удалить</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Форма для добавления и редактирования пары -->
<h2>Добавить или редактировать пару</h2>
<form id="pairForm">
    <label for="driverSelect">Выберите водителя:</label>
    <select id="driverSelect" required>
        @foreach (var driver in Model.Drivers)
        {
            <option value="@driver.Id">@driver.Fio</option>
        }
    </select><br />

    <label for="carSelect">Выберите машину:</label>
    <select id="carSelect" required>
        @foreach (var car in Model.Cars)
        {
            <option value="@car.Id">@car.BrandModel (@car.PlateNumber)</option>
        }
    </select><br />

    <label for="rent">Аренда:</label>
    <input type="number" id="rent" step="0.01" required /><br />

    <input type="hidden" id="pairId" />
    <button type="submit" id="saveButton">Добавить пару</button>
    <button type="button" id="cancelButton">Отмена</button>
</form>

<!-- Блок для кнопки списания аренды -->
<div id="writeOffBlock">
    <h2>Списание аренды</h2>
    <button id="writeOffButton">Списать аренду</button>
    <form action="/home/changejobstatus" method="post">
        <p style="color: @(Model.IsJobEnable ? "green" : "red")">Автоматическое списание аренды @(Model.IsJobEnable ? "включено" : "выключено")</p>
        <input name="newStatus" hidden value="@((!Model.IsJobEnable).ToString())"/>
        <button type="submit">@(Model.IsJobEnable ? "Выключить" : "Включить")</button>
    </form>
</div>


@section Scripts
    {
    <script src="js/index.js"></script>
}